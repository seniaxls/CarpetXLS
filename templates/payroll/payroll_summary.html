{% extends "admin/base_site.html" %}

{% block content %}
<style>
    .form-inline .form-group {
        display: flex;
        margin-right: 10px;
    }
    .form-inline .form-group label {
        margin-right: 5px;
    }
</style>

<div class="container mt-4">
    <h1>Payroll Summary</h1>
    <form method="get" class="form-inline">
        <div class="form-group mx-sm-3 mb-2">
            {{ form.user.label_tag }}
            {{ form.user }}
        </div>
        <div class="form-group mx-sm-3 mb-2">
            {{ form.year.label_tag }}
            {{ form.year }}
        </div>
        <div class="form-group mx-sm-3 mb-2">
            {{ form.month.label_tag }}
            {{ form.month }}
        </div>
        <div class="form-group mx-sm-3 mb-2">
            {{ form.status.label_tag }}
            {{ form.status }}
        </div>
        <div class="form-group mx-sm-3 mb-2">
            {{ form.product_name.label_tag }}
            {{ form.product_name }}
        </div>
        <div class="form-group mx-sm-3 mb-2">
            {{ form.additional_product_name.label_tag }}
            {{ form.additional_product_name }}
        </div>
        <button type="submit" class="btn btn-primary mb-2">Поиск</button>
    </form>

    {% if totals %}
        <h2>Totals:</h2>
        <ul>
            <li>Area: {{ totals.area|default_if_none:"" }}</li>
            <li>Additional Product Area: {{ totals.additional_product_area|default_if_none:"" }}</li>
            <li>Additional Product Price: {{ totals.additional_product_price|default_if_none:"" }}</li>
            <li>Overlock: {{ totals.overlock|default_if_none:"" }}</li>
            <li>Allowance: {{ totals.allowance|default_if_none:"" }}</li>
        </ul>
    {% endif %}

    {% if grouped_records %}
        <h2>Grouped Records:</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Product Name</th>
                    <th>Additional Product Name</th>
                    <th>Count</th>
                    <th>Total Area</th>
                    <th>Total Additional Product Area</th>
                    <th>Total Additional Product Price</th>
                    <th>Total Overlock</th>
                    <th>Total Allowance</th>
                </tr>
            </thead>
            <tbody>
                {% for key, data in grouped_records.items %}
                    <tr>
                        <td>{{ key.0|default_if_none:"" }}</td>
                        <td>{{ key.1|default_if_none:"" }}</td>
                        <td>{{ key.2|default_if_none:"" }}</td>
                        <td>{{ data.count }}</td>
                        <td>{{ data.total_area|floatformat:2|default_if_none:"" }}</td>
                        <td>{{ data.total_additional_product_area|floatformat:2|default_if_none:"" }}</td>
                        <td>{{ data.total_additional_product_price|floatformat:2|default_if_none:"" }}</td>
                        <td>{{ data.total_overlock|floatformat:2|default_if_none:"" }}</td>
                        <td>{{ data.total_allowance|floatformat:2|default_if_none:"" }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>
{% endblock %}